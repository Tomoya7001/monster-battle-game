# 冒険システム仕様書

**作成日**: 2025-12-16  
**バージョン**: v1.0  
**ステータス**: Phase1 確定版

---

## 1. 概要

冒険システムはPvEコンテンツの中核。ステージを攻略し、素材・経験値・報酬を獲得する。

---

## 2. コンテンツ構成

### 2.1 冒険タイプ

| タイプ | 説明 | リセット |
|--------|------|---------|
| **ストーリー** | メインコンテンツ、順次解放 | なし（永続） |
| **デイリー** | 日替わりクエスト | 毎日0時 |
| **イベント** | 期間限定コンテンツ | イベント終了時 |

### 2.2 進行フロー

```
【ストーリー進行】
エリア選択 → エンカウント（5回）→ ボス解放 → ボス撃破 → 次エリア解放

【1エンカウントの流れ】
1. ランダムモンスター出現
2. バトル開始（現在HP使用）
3. 勝利 → 報酬獲得
4. 敗北 → エンカウント進捗維持、HPはそのまま

【ボス戦の流れ】
1. エンカウント5回達成でボス解放
2. ボス戦開始（最大3体のボス）
3. 勝利 → 大量報酬 + 次エリア解放
4. 敗北 → 再挑戦可能
```

---

## 3. ステージ構成

### 3.1 エリア一覧（Phase1）

| ステージID | エリア名 | 難易度 | 推奨Lv | 解放条件 |
|-----------|---------|--------|--------|---------|
| stage_001 | 初心者の森 | ★☆☆☆☆ | 5 | 初期解放 |
| stage_002 | 炎の洞窟 | ★★☆☆☆ | 10 | 1-1クリア |
| stage_003 | 水の神殿 | ★★☆☆☆ | 15 | 1-2クリア |
| stage_004 | 雷の峡谷 | ★★★☆☆ | 20 | 1-3クリア |
| stage_005 | 風の高原 | ★★★☆☆ | 25 | 1-4クリア |
| stage_006 | 大地の洞窟 | ★★★★☆ | 30 | 1-5クリア |
| stage_007 | 光の聖域 | ★★★★☆ | 35 | 1-6クリア |
| stage_008 | 闇の深淵 | ★★★★★ | 40 | 1-7クリア |

### 3.2 ステージデータ構造

```json
{
  "stage_id": "stage_001",
  "name": "初心者の森",
  "stage_type": "normal",
  "difficulty": 1,
  "recommendedLevel": 5,
  "description": "冒険者たちが最初に訪れる平和な森",
  "encounter_monster_ids": ["21", "22", "23", "24", "25"],
  "encounters_to_boss": 5,
  "boss_stage_id": "stage_001_boss",
  "rewards": {
    "exp": 30,
    "gold": 50,
    "gems": 0,
    "drop_items": [...]
  }
}
```

---

## 4. エンカウントシステム

### 4.1 ランダムエンカウント

```
【出現モンスター決定】
1. ステージの encounter_monster_ids から抽選
2. ランダムに1体選出
3. レベルはステージ推奨Lv ± 2

【エンカウント進捗】
- 勝利: エンカウントカウント+1
- 敗北: カウント維持（減らない）
- 5回勝利でボス解放
```

### 4.2 HPの扱い

```
【冒険中のHP】
- 現在HPを使用（最大HPではない）
- バトル後もHPは回復しない
- 複数のエンカウントを連続で行う場合、HPを管理する必要あり

【HP回復手段】
- 時間経過（5分ごとに5%回復）
- 回復アイテム使用
- ホーム画面の回復タブ
```

### 4.3 オートバトル

```
【AUTO機能】
- 連続でエンカウントを自動実行
- 最大10回まで設定可能
- 敗北時は自動停止

【AUTO中の動作】
1. エンカウント開始
2. AI自動行動
3. 勝利 → 報酬獲得 → 次のエンカウントへ
4. 敗北 → AUTO終了
5. ボス解放 → AUTO終了（手動でボス戦）
```

---

## 5. ボス戦システム

### 5.1 ボス戦の仕様

```
【解放条件】
- エンカウント5回勝利で解放
- 一度解放されたら永続（再度エンカウント不要）

【ボス構成】
- 最大3体のボスモンスター
- 通常モンスターより高ステータス
- 専用の行動パターン

【難易度】
- 推奨レベル = ステージ推奨Lv + 3
- ステータス補正 = 通常モンスターの1.5倍
```

### 5.2 ボスデータ構造

```json
{
  "stage_id": "stage_001_boss",
  "name": "初心者の森ボス",
  "stage_type": "boss",
  "difficulty": 2,
  "recommendedLevel": 8,
  "parent_stage_id": "stage_001",
  "boss_monster_ids": ["11", "12", "13"],
  "rewards": {
    "exp": 200,
    "gold": 500,
    "gems": 10,
    "drop_items": [...]
  }
}
```

### 5.3 ボス撃破報酬

| 報酬種別 | 通常 | ボス |
|----------|------|------|
| 経験値 | ×1 | ×5-10 |
| ゴールド | ×1 | ×5-10 |
| ジェム | 0 | 5-20 |
| レアドロップ率 | 低 | 高（×1.5） |

---

## 6. 報酬システム

### 6.1 報酬の種類

| 報酬 | 説明 | 入手元 |
|------|------|--------|
| 経験値 | モンスター育成用 | 全バトル |
| ゴールド | 汎用通貨 | 全バトル |
| ジェム | 課金通貨（少量） | ボス戦、初回クリア |
| 素材 | 装備作成用 | ドロップ |
| 装備 | 直接入手 | ボスドロップ（低確率） |

### 6.2 ドロップシステム

```
【ドロップ判定】
1. ステージのdrop_itemsからアイテム候補を取得
2. 各アイテムのdrop_rateで判定
3. ボス戦の場合は確率×1.5

【ドロップ率の目安】
- 低レア素材: 30-50%
- 中レア素材: 15-30%
- 高レア素材: 5-15%
- 装備直ドロップ: 1-5%
```

### 6.3 初回クリア報酬

```
【初回クリア時のみ】
- ジェム: 10-50
- 特別素材: 1-3個
- 称号（一部ステージ）

【周回時】
- 経験値、ゴールド、素材のみ
- ジェムは付与されない
```

---

## 7. 探索システム（派遣）

### 7.1 探索の仕様

```
【基本ルール】
- モンスターを派遣して時間経過で報酬獲得
- 派遣中のモンスターはバトルに使用不可
- 最大3箇所同時探索可能

【探索時間】
- 短時間: 1時間
- 中時間: 3時間
- 長時間: 8時間

【報酬】
- 時間に比例して増加
- 派遣モンスターのレベルで報酬量UP
```

### 7.2 探索先一覧

| 探索先 | 時間 | 必要数 | 主な報酬 |
|--------|------|--------|---------|
| 森の奥地 | 1時間 | 1体 | 木材、低レア素材 |
| 山の頂上 | 3時間 | 2体 | 鉱石、中レア素材 |
| 深海の洞窟 | 8時間 | 3体 | 高レア素材、装備 |

### 7.3 探索UIフロー

```
1. 探索タブを開く
2. 探索先を選択
3. 派遣するモンスターを選択
4. 探索開始
5. 時間経過後、報酬受け取り
```

---

## 8. 進捗管理

### 8.1 ユーザー進捗データ

```json
{
  "user_id": "xxx",
  "area_id": 1,
  "is_unlocked": true,
  "is_cleared": true,
  "encounter_count": 3,
  "boss_unlocked": true,
  "boss_defeated": true,
  "total_clears": 15,
  "best_clear_time": 120,
  "first_cleared_at": "2025-01-20T15:30:00Z"
}
```

### 8.2 解放条件の判定

```
【次エリア解放条件】
- 現エリアのボス撃破

【判定フロー】
1. ボス撃破時にuser_adventure_progressを更新
2. 次エリアのis_unlockedをtrueに
3. クライアントに解放通知
```

---

## 9. デイリークエスト

### 9.1 日替わりコンテンツ

```
【リセット】
毎日0:00（サーバー時間）

【内容】
- 特定属性モンスター討伐
- 特定ステージ周回
- ボス撃破

【報酬】
- 経験値ボーナス
- ゴールドボーナス
- 日替わり素材
```

### 9.2 デイリー報酬

| クエスト | 条件 | 報酬 |
|----------|------|------|
| 冒険3回 | エンカウント3回勝利 | 経験値×500 |
| ボス討伐 | ボス1体撃破 | ゴールド×1000 |
| 属性討伐 | 炎属性5体撃破 | 炎の欠片×3 |

---

## 10. イベントステージ

### 10.1 期間限定コンテンツ

```
【開催期間】
- 通常: 1-2週間
- 大型: 1ヶ月

【特徴】
- 限定モンスター出現
- 限定装備ドロップ
- 限定報酬

【難易度】
- 初級: 推奨Lv10
- 中級: 推奨Lv25
- 上級: 推奨Lv40
- 超級: 推奨Lv50（エンドコンテンツ）
```

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0 | 2025-12-16 | 初版作成 |

---

## 関連ドキュメント

- [バトルシステム仕様書](./battle_system_v7.1.md)
- [装備・アイテムシステム仕様書](./equipment_system.md)
- [ステージマスターデータ](../assets/data/stage_masters.json)
